# OAuth2 Proxy - Prod environment
# Production-grade: 3 replicas, strict security

replicaCount: 3

config:
  existingSecret: oauth2-proxy-credentials
  configFile: |-
    email_domains = [ "*" ]
    upstreams = [ "file:///dev/null" ]
    cookie_secure = true
    cookie_httponly = true
    cookie_samesite = "lax"
    pass_access_token = true
    set_xauthrequest = true
    set_authorization_header = true
    session_store_type = "redis"

# PLACEHOLDER: Replace with your OIDC provider
extraArgs:
  provider: oidc
  oidc-issuer-url: "https://idp.example.com"
  login-url: "https://idp.example.com/authorize"
  redeem-url: "https://idp.example.com/oauth/token"
  validate-url: "https://idp.example.com/userinfo"
  scope: "openid profile email"

resources:
  requests:
    cpu: 200m
    memory: 256Mi
  limits:
    cpu: 1000m
    memory: 512Mi

ingress:
  enabled: true
  className: ""
  hosts:
    - auth.example.com
  tls:
    - secretName: oauth2-proxy-tls
      hosts:
        - auth.example.com

service:
  type: ClusterIP
  portNumber: 80

topologySpreadConstraints:
  - maxSkew: 1
    topologyKey: topology.kubernetes.io/zone
    whenUnsatisfiable: DoNotSchedule

# Enable Redis for session persistence in production
redis:
  enabled: true
  sentinel:
    enabled: true
